#!/usr/bin/env bash

# POSIX-friendly deploy script for macOS/Linux users.

echo "========================================"
echo "üöÄ –î–µ–ø–ª–æ–π –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ GitHub"
echo "========================================"
echo

if [[ ! -d .git ]]; then
  echo "‚ùå Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!"
  echo "–°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—ã –∏–∑ DEPLOY.md"
  exit 1
fi

COMMIT_MESSAGE=${1:-"Update miniapp"}

echo "üì¶ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π..."
git add .

echo "üíæ –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–º–∏—Ç–∞: \"$COMMIT_MESSAGE\""
if git commit -m "$COMMIT_MESSAGE"; then
  echo "‚¨ÜÔ∏è –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ GitHub..."
  if git push; then
    echo
    echo "‚úÖ –£—Å–ø–µ—à–Ω–æ! –ò–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω—ã –Ω–∞ GitHub"
    echo "‚è±Ô∏è –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞ GitHub Pages –∑–∞–π–º—ë—Ç 1-2 –º–∏–Ω—É—Ç—ã"
  else
    echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –Ω–∞ GitHub"
    exit 1
  fi
else
  echo "‚ÑπÔ∏è –ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –∫–æ–º–º–∏—Ç–∞"
fi

echo
echo "========================================"
