<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Помощь слабовидящим - Хакатон 573</title>
    <link rel="stylesheet" href="style.css">
    <!-- MAX Bridge библиотека -->
    <script src="https://platform.max.ru/max-bridge.js"></script>
</head>
<body>
    <div class="container">
        <!-- Заголовок -->
        <header class="header">
            <h1>Помощь слабовидящим</h1>
            <p class="subtitle">Быстрая связь с волонтёром</p>
            <!-- Блок для отображения user_id (для тестирования) -->
            <div id="userIdDisplay" style="background: rgba(255,255,255,0.2); padding: 10px; margin-top: 10px; border-radius: 8px; font-size: 14px;">
                <strong>User ID:</strong> <span id="userIdValue">не определён</span><br>
                <strong>Room ID:</strong> <span id="roomIdValue">не определён</span><br>
                <strong>Role:</strong> <span id="roleValue">не определён</span>
            </div>
        </header>

        <!-- Главный экран -->
        <main class="main" id="mainScreen">
            <!-- Статус подключения -->
            <div class="status-card" id="statusCard">
                <div class="status-indicator" id="statusIndicator">
                    <span class="status-dot"></span>
                    <span id="statusText">Подключение к MAX...</span>
                </div>
            </div>

            <!-- Основная кнопка вызова -->
            <div class="call-section">
                <button class="btn-call" id="callBtn" disabled>
                    <span class="btn-text">Позвать волонтёра</span>
                </button>
                <p class="call-hint">Нажмите кнопку, и мы соединим вас<br>с волонтёром для помощи</p>
            </div>

            <!-- Быстрые действия -->
            <div class="quick-actions">
                <h2>Чем мы можем помочь?</h2>
                <div class="actions-grid">
                    <button class="action-card" data-action="read">
                        <span class="action-text">Прочитать текст</span>
                    </button>
                    <button class="action-card" data-action="describe">
                        <span class="action-text">Описать изображение</span>
                    </button>
                    <button class="action-card" data-action="navigate">
                        <span class="action-text">Помочь с навигацией</span>
                    </button>
                    <button class="action-card" data-action="other">
                        <span class="action-text">Другое</span>
                    </button>
                </div>
            </div>

            <!-- Режим тестирования (для двух ноутбуков без MAX) -->
            <section class="dev-panel hidden" id="devPanel">
                <h3>Режим тестирования (без MAX)</h3>
                <p class="dev-panel-text">
                    Укажите адрес сигнального сервера и общий Room ID, чтобы соединить два устройства напрямую.
                </p>
                <div class="dev-input-grid">
                    <label>
                        <span>Signaling URL (wss)</span>
                        <input type="text" id="devSignalingUrl" placeholder="wss://example.ngrok-free.app/ws">
                    </label>
                    <label>
                        <span>Room ID</span>
                        <input type="text" id="devRoomId" placeholder="team-room">
                    </label>
                </div>
                <div class="dev-actions">
                    <button type="button" id="devSaveBtn">Сохранить</button>
                    <button type="button" id="devVolunteerToggle">Режим волонтёра</button>
                    <button type="button" id="devResetBtn" class="ghost">Сбросить</button>
                </div>
                <p class="dev-status" id="devStatusText">Ожидает настроек</p>
                <p class="dev-hint">
                    1) Запустите signaling сервер (`npm run start-signaling`). 2) При необходимости пробросьте порт через `ngrok http 3001`.
                    3) На обоих устройствах введите один и тот же Room ID. Один из ноутов включает режим волонтёра и ждёт вызов.
                </p>
            </section>
        </main>

        <!-- Экран ожидания волонтёра -->
        <div class="waiting-screen hidden" id="waitingScreen">
            <div class="waiting-content">
                <div class="spinner"></div>
                <h2>Ищем волонтёра...</h2>
                <p>Пожалуйста, подождите. Обычно это занимает меньше минуты.</p>
                <button class="btn-secondary" id="cancelWaitBtn">Отменить</button>
            </div>
        </div>

        <!-- Экран активного звонка -->
        <div class="call-screen hidden" id="callScreen">
            <div class="call-content">
                <div class="video-wrapper">
                    <video id="remoteVideo" class="remote-video" autoplay playsinline></video>
                    <div class="video-placeholder" id="remotePlaceholder">
                        <p>Ждем подключение волонтера...</p>
                    </div>
                    <video id="localVideo" class="local-video" autoplay playsinline muted></video>
                </div>

                <div class="call-info">
                    <h2>Волонтёр на связи</h2>
                    <p class="volunteer-name" id="volunteerName">Анонимный волонтёр</p>
                    <p class="call-status" id="callStatusText">Подключаемся...</p>
                    <div class="call-timer" id="callTimer">00:00</div>
                </div>
                
                <div class="call-controls">
                    <button class="control-btn mute-btn" id="muteBtn">
                        <span class="control-text">Выкл. микрофон</span>
                    </button>
                    <button class="control-btn camera-btn" id="cameraBtn">
                        <span class="control-text">Выкл. камеру</span>
                    </button>
                    <button class="control-btn end-btn" id="endCallBtn">
                        <span class="control-text">Завершить</span>
                    </button>
                </div>

                <!-- Чат для текстовых сообщений -->
                <div class="chat-toggle">
                    <button id="toggleChatBtn">Открыть чат</button>
                </div>
            </div>
        </div>

        <!-- Футер -->
        <footer class="footer">
            <p>Создано на хакатоне MAX</p>
            <p class="footer-small">Проект "Помощь слабовидящим"</p>
        </footer>
    </div>

    <!-- Подключаем скрипт приложения -->
    <script src="app.js"></script>
</body>
</html>

